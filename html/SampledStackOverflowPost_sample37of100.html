Answered posted on: 2015-01-16 16:39:32+00:00
<a<p>On some implementations <a href="http://man7.org/linux/man-pages/man2/select.2.html" rel="nofollow">select(2)</a> is allowed to modify the file descriptor sets and the timeout. So you should set these inside the loop just before the <code>select</code></p>

<pre><code>while(1) {
  FD_ZERO(&amp;rfds);
  FD_SET(0,&amp;rfds);
  tv.tv_sec = 5;
  tv.tv_usec = 0;
  int ns = select(1,&amp;rfds,NULL,NULL,&amp;tv);
  if (ns &lt; 0 &amp;&amp; errno == EINTR) continue;
  else if (ns &lt; 0) { perror("select"); exit(EXIT_FAILURE); };
</code></pre>

<p>You need to keep the result <code>ns</code> of <code>select</code>, and you need to handle error cases. You probably should inspect <code>rfds</code> and <code>tv</code> <em>after</em> your <code>select</code> -when it is successful (<code>ns&gt;0</code>)...</p>

<p>As I commented, you should use <a href="http://man7.org/linux/man-pages/man2/poll.2.html" rel="nofollow">poll(2)</a> instead of <code>select</code> (since <code>poll</code> is more ***<a href="https://en.wikipedia.org/wiki/C10k_problem" rel="nofollow">C10K problem</a> friendly, and since the size of your system's <code>fd_set</code> is <em>compile</em>-time limiting the highest file descriptor)</p>

<p>Notice that if your <em>stdin</em> is a <em>tty</em> things are quite complex (since usually <em>tty</em>-s are <em>kernel</em> buffered, see the <a href="http://www.linusakesson.net/programming/tty/" rel="nofollow">tty demystified</a> page).</
