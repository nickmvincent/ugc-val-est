<a<p>It's true that if x is <em>relatively prime</em> to n (x and n have no common factors), then x^a = x^(phi(a)) (mod n), where phi is Euler's totient function. That's because then x belongs to the ***<a href="http://en.wikipedia.org/wiki/Multiplicative_group_of_integers_modulo_n" rel="nofollow">multiplicative group of (Z/nZ)</a>, which has order phi(a).</p>

<p>But, for x not relatively prime to n, this is no longer true. In your example, the base does have a common factor with your modulus, namely 2. So the trick will not work here. If you wanted to, though, you could write some extra code to deal with this case -- maybe find the largest power of 2 that x is divisible by, say 2^k. Then divide x by 2^k, run your original code, shift its output left by k*e, where e is your exponent, and reduce modulo M. Of course, if k isn't zero, this would usually result in an answer of zero.
